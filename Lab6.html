
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Mapa Interativo - Vítimas por Município</title>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
    #mapa { width: 100%; height: 600px; margin-bottom: 30px; }
    #grafico-municipios { width: 100%; height: 500px; }
    select { font-size: 16px; padding: 6px 10px; margin-bottom: 20px; }
    h2, h3 { text-align: center; }
  </style>
</head>
<body>
  <h2>Mapa Interativo - Vítimas por Município</h2>
  <h3>Clique em um estado e veja os municípios mais afetados</h3>
  <div style="text-align:center;">
    <label for="anoSelect">Selecione o Ano: </label>
    <select id="anoSelect"></select>
  </div>
  <div id="mapa"></div>
  <div id="grafico-municipios"></div>

  <script>
    const dadosPorEstado = {"AC": {"2018": [{"name": "Acrelândia", "value": 5}, {"name": "Assis Brasil", "value": 7}, {"name": "Brasiléia", "value": 7}, {"name": "Bujari", "value": 2}, {"name": "Capixaba", "value": 10}, {"name": "Cruzeiro Do Sul", "value": 59}, {"name": "Epitaciolândia", "value": 1}, {"name": "Feijó", "value": 16}, {"name": "Jordão", "value": 1}, {"name": "Manoel Urbano", "value": 0}, {"name": "Marechal Thaumaturgo", "value": 1}, {"name": "Mâncio Lima", "value": 8}, {"name": "Plácido De Castro", "value": 7}, {"name": "Porto Acre", "value": 4}, {"name": "Porto Walter", "value": 0}, {"name": "Rio Branco", "value": 227}, {"name": "Rodrigues Alves", "value": 4}, {"name": "Santa Rosa Do Purus", "value": 0}, {"name": "Sena Madureira", "value": 10}, {"name": "Senador Guiomard", "value": 9}, {"name": "Tarauacá", "value": 16}, {"name": "Xapuri", "value": 2}], "2019": [{"name": "Acrelândia", "value": 2}, {"name": "Assis Brasil", "value": 3}, {"name": "Brasiléia", "value": 4}, {"name": "Bujari", "value": 1}, {"name": "Cruzeiro Do Sul", "value": 21}, {"name": "Epitaciolândia", "value": 3}, {"name": "Feijó", "value": 10}, {"name": "Jordão", "value": 1}, {"name": "Manoel Urbano", "value": 3}, {"name": "Mâncio Lima", "value": 6}, {"name": "Plácido De Castro", "value": 8}, {"name": "Porto Acre", "value": 4}, {"name": "Rio Branco", "value": 167}, {"name": "Rodrigues Alves", "value": 5}, {"name": "Sena Madureira", "value": 9}, {"name": "Senador Guiomard", "value": 6}, {"name": "Tarauacá", "value": 14}, {"name": "Xapuri", "value": 3}], "2020": [{"name": "Acrelândia", "value": 1}, {"name": "Assis Brasil", "value": 1}, {"name": "Brasiléia", "value": 5}, {"name": "Bujari", "value": 8}, {"name": "Capixaba", "value": 0}, {"name": "Cruzeiro Do Sul", "value": 11}, {"name": "Epitaciolândia", "value": 8}, {"name": "Feijó", "value": 13}, {"name": "Jordão", "value": 1}, {"name": "Manoel Urbano", "value": 6}, {"name": "Marechal Thaumaturgo", "value": 1}, {"name": "Mâncio Lima", "value": 4}, {"name": "Plácido De Castro", "value": 2}, {"name": "Porto Acre", "value": 5}, {"name": "Porto Walter", "value": 2}, {"name": "Rio Branco", "value": 170}, {"name": "Rodrigues Alves", "value": 4}, {"name": "Santa Rosa Do Purus", "value": 1}, {"name": "Sena Madureira", "value": 8}, {"name": "Senador Guiomard", "value": 6}, {"name": "Tarauacá", "value": 9}, {"name": "Xapuri", "value": 4}], "2021": [{"name": "Acrelândia", "value": 1}, {"name": "Assis Brasil", "value": 3}, {"name": "Brasiléia", "value": 10}, {"name": "Bujari", "value": 1}, {"name": "Capixaba", "value": 0}, {"name": "Cruzeiro Do Sul", "value": 10}, {"name": "Epitaciolândia", "value": 3}, {"name": "Feijó", "value": 9}, {"name": "Jordão", "value": 0}, {"name": "Manoel Urbano", "value": 2}, {"name": "Marechal Thaumaturgo", "value": 2}, {"name": "Mâncio Lima", "value": 2}, {"name": "Plácido De Castro", "value": 3}, {"name": "Porto Acre", "value": 5}, {"name": "Porto Walter", "value": 0}, {"name": "Rio Branco", "value": 98}, {"name": "Rodrigues Alves", "value": 3}, {"name": "Santa Rosa Do Purus", "value": 0}, {"name": "Sena Madureira", "value": 4}, {"name": "Senador Guiomard", "value": 3}, {"name": "Tarauacá", "value": 10}, {"name": "Xapuri", "value": 2}], "2022": [{"name": "Acrelândia", "value": 5}, {"name": "Assis Brasil", "value": 4}, {"name": "Brasiléia", "value": 19}, {"name": "Bujari", "value": 3}, {"name": "Capixaba", "value": 3}, {"name": "Cruzeiro Do Sul", "value": 11}, {"name": "Epitaciolândia", "value": 6}, {"name": "Feijó", "value": 15}, {"name": "Jordão", "value": 2}, {"name": "Manoel Urbano", "value": 3}, {"name": "Marechal Thaumaturgo", "value": 3}, {"name": "Mâncio Lima", "value": 4}, {"name": "Plácido De Castro", "value": 2}, {"name": "Porto Acre", "value": 4}, {"name": "Porto Walter", "value": 2}, {"name": "Rio Branco", "value": 80}, {"name": "Rodrigues Alves", "value": 2}, {"name": "Santa Rosa Do Purus", "value": 0}, {"name": "Sena Madureira", "value": 14}, {"name": "Senador Guiomard", "value": 13}, {"name": "Tarauacá", "value": 10}, {"name": "Xapuri", "value": 2}]}};

    const chartMapa = echarts.init(document.getElementById('mapa'));
    const chartMunicipios = echarts.init(document.getElementById('grafico-municipios'));

    let anoAtual = Object.keys(dadosPorEstado['PB'])[0];

    const selectAno = document.getElementById('anoSelect');
    const anosDisponiveis = new Set();
    Object.values(dadosPorEstado).forEach(estado => {
      Object.keys(estado).forEach(ano => anosDisponiveis.add(ano));
    });
    const anos = Array.from(anosDisponiveis).sort();
    anos.forEach(ano => {
      const opt = document.createElement('option');
      opt.value = ano;
      opt.text = ano;
      selectAno.appendChild(opt);
    });
    selectAno.value = anoAtual;
    selectAno.addEventListener('change', () => {
      anoAtual = selectAno.value;
      atualizarMapa();
    });

    function atualizarMapa() {
      const mapaData = Object.entries(dadosPorEstado).map(([estado, anos]) => {
        const municipios = anos[anoAtual] || [];
        const total = municipios.reduce((acc, cur) => acc + cur.value, 0);
        return { name: estado, value: total };
      });

      chartMapa.setOption({
        title: {
          text: `Vítimas por Estado (${anoAtual})`,
          left: 'center'
        },
        tooltip: {
          trigger: 'item',
          formatter: '{b}<br/>Total: {c} vítimas'
        },
        visualMap: {
          min: 0,
          max: Math.max(...mapaData.map(d => d.value)) || 100,
          left: 'left',
          top: 'bottom',
          text: ['Mais', 'Menos'],
          calculable: true,
          inRange: {
            color: ['#f2f0f7', '#9e9ac8', '#6a51a3']
          }
        },
        series: [{
          type: 'map',
          map: 'BR',
          roam: true,
          data: mapaData
        }]
      });
    }

    $.get('https://raw.githubusercontent.com/codeforamerica/click_that_hood/master/public/data/brazil-states.geojson', function (geoJson) {
      echarts.registerMap('BR', geoJson);
      atualizarMapa();

      chartMapa.on('click', function (params) {
        const estado = params.name;
        const dados = dadosPorEstado[estado] && dadosPorEstado[estado][anoAtual];
        if (!dados) {
          chartMunicipios.clear();
          return;
        }
        const nomes = dados.map(d => d.name);
        const valores = dados.map(d => d.value);

        chartMunicipios.setOption({
          title: {
            text: `Vítimas por Município - ${estado} (${anoAtual})`,
            left: 'center'
          },
          tooltip: {},
          xAxis: {
            type: 'category',
            data: nomes,
            axisLabel: { rotate: 45 }
          },
          yAxis: {
            type: 'value'
          },
          series: [{
            type: 'bar',
            data: valores
          }]
        });
      });
    });

    window.addEventListener('resize', () => {
      chartMapa.resize();
      chartMunicipios.resize();
    });
  </script>
</body>
</html>
